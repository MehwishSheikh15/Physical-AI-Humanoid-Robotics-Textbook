"use strict";(globalThis.webpackChunkai_robotics_book=globalThis.webpackChunkai_robotics_book||[]).push([[765],{5770:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Module-1-ROS2/week-05-ros2-advanced","title":"Week 5: ROS 2 Advanced Patterns","description":"Master actions, parameters, launch files, and transforms (tf2) to build production-ready robotic systems.","source":"@site/docs/Module-1-ROS2/week-05-ros2-advanced.mdx","sourceDirName":"Module-1-ROS2","slug":"/Module-1-ROS2/week-05-ros2-advanced","permalink":"/ai-robotics-book/docs/Module-1-ROS2/week-05-ros2-advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/ai-robotics/ai-robotics-book/tree/main/docs/Module-1-ROS2/week-05-ros2-advanced.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Week 5: ROS 2 Advanced Patterns","description":"Master actions, parameters, launch files, and transforms (tf2) to build production-ready robotic systems."},"sidebar":"tutorialSidebar","previous":{"title":"Week 4: ROS 2 Topics and Services","permalink":"/ai-robotics-book/docs/Module-1-ROS2/week-04-ros2-topics-services"},"next":{"title":"Week 6: Robot Simulation Fundamentals with Gazebo","permalink":"/ai-robotics-book/docs/Module-2-GAZEBO/week-06-gazebo-fundamentals"}}');var a=s(4848),t=s(8453);const i={sidebar_position:5,title:"Week 5: ROS 2 Advanced Patterns",description:"Master actions, parameters, launch files, and transforms (tf2) to build production-ready robotic systems."},o="Week 5: ROS 2 Advanced Patterns",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Actions: Long-Running Tasks with Feedback",id:"actions-long-running-tasks-with-feedback",level:2},{value:"Why Actions?",id:"why-actions",level:3},{value:"Action Structure",id:"action-structure",level:3},{value:"Code Example: Action Server",id:"code-example-action-server",level:3},{value:"Code Example: Action Client",id:"code-example-action-client",level:3},{value:"Parameters: Runtime Configuration",id:"parameters-runtime-configuration",level:2},{value:"Why Parameters?",id:"why-parameters",level:3},{value:"Declaring and Using Parameters",id:"declaring-and-using-parameters",level:3},{value:"Setting Parameters from Command Line",id:"setting-parameters-from-command-line",level:3},{value:"Loading Parameters from YAML",id:"loading-parameters-from-yaml",level:3},{value:"Launch Files: Orchestrating Complex Systems",id:"launch-files-orchestrating-complex-systems",level:2},{value:"Why Launch Files?",id:"why-launch-files",level:3},{value:"Python Launch File",id:"python-launch-file",level:3},{value:"Running Launch Files",id:"running-launch-files",level:3},{value:"Transforms (tf2): Managing Coordinate Frames",id:"transforms-tf2-managing-coordinate-frames",level:2},{value:"Why tf2?",id:"why-tf2",level:3},{value:"Publishing a Static Transform",id:"publishing-a-static-transform",level:3},{value:"Querying Transforms",id:"querying-transforms",level:3},{value:"Visualizing Transforms in RViz",id:"visualizing-transforms-in-rviz",level:3},{value:"Best Practices for Production Systems",id:"best-practices-for-production-systems",level:2},{value:"Self-Assessment Questions",id:"self-assessment-questions",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"week-5-ros-2-advanced-patterns",children:"Week 5: ROS 2 Advanced Patterns"})}),"\n",(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsxs)(n.p,{children:["You now understand the basics of ROS 2: nodes, topics, and services. This week, we level up with advanced patterns that professional roboticists use daily: ",(0,a.jsx)(n.strong,{children:"actions"})," for long-running tasks with feedback, ",(0,a.jsx)(n.strong,{children:"parameters"})," for runtime configuration, ",(0,a.jsx)(n.strong,{children:"launch files"})," for managing complex node systems, and ",(0,a.jsx)(n.strong,{children:"tf2"})," for coordinate frame transforms."]}),"\n",(0,a.jsx)(n.p,{children:"These patterns separate prototypes from production-ready systems. Actions enable responsive user interfaces by providing progress feedback during long operations. Parameters allow tuning behavior without recompiling code. Launch files automate the startup of dozens of nodes with a single command. And tf2 is the secret sauce that makes sensor fusion and manipulation possible by managing spatial relationships between robot parts and the world."}),"\n",(0,a.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,a.jsx)(n.p,{children:"By the end of this week, you will be able to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Implement"})," action servers and clients for long-running tasks with preemption and feedback"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Configure"})," nodes using parameters loaded from YAML files"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Create"})," launch files to start multiple nodes with complex configurations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use"})," tf2 to manage coordinate frame transforms for sensor fusion"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Apply"})," best practices for production-ready ROS 2 systems"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"actions-long-running-tasks-with-feedback",children:"Actions: Long-Running Tasks with Feedback"}),"\n",(0,a.jsx)(n.h3,{id:"why-actions",children:"Why Actions?"}),"\n",(0,a.jsx)(n.p,{children:"Imagine asking a robot to navigate to a goal 50 meters away. This takes 30-60 seconds. With a service:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Client blocks for the entire duration (no UI updates)"}),"\n",(0,a.jsx)(n.li,{children:"Can't cancel mid-execution"}),"\n",(0,a.jsx)(n.li,{children:"No progress updates"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)("span",{className:"highlight-purple",children:(0,a.jsx)(n.strong,{children:"Actions"})})," solve this with:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Asynchronous execution"}),": Client doesn't block"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Feedback"}),': Regular progress updates (e.g., "80% to goal")']}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Preemption"}),": Can cancel or replace goals mid-execution"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Result"}),": Final outcome when task completes"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant C as Action Client\n    participant S as Action Server\n    participant R as Robot\n\n    C->>S: Send Goal (target_pose)\n    S->>C: Goal Accepted\n\n    loop Navigation in progress\n        S->>R: Send motor commands\n        R->>S: Current state\n        S->>C: Feedback (80% complete)\n    end\n\n    Note over C: User can cancel<br/>at any time\n\n    S->>C: Result (success=true)\n\n    style S fill:#a855f7,stroke:#9333ea,stroke-width:2px,color:#fff\n    style C fill:#ec4899,stroke:#db2777,stroke-width:2px,color:#fff\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Diagram:"})," Actions provide asynchronous long-running tasks with continuous feedback and the ability to cancel mid-execution."]}),"\n",(0,a.jsx)(n.h3,{id:"action-structure",children:"Action Structure"}),"\n",(0,a.jsxs)(n.p,{children:["An action definition (",(0,a.jsx)(n.code,{children:".action"})," file) has three parts:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"# NavigateToGoal.action\n\n# GOAL: What the client wants\ngeometry_msgs/PoseStamped target_pose\n---\n# RESULT: Final outcome (sent once when done)\nbool success\nfloat32 total_distance_traveled\n---\n# FEEDBACK: Progress updates (sent multiple times)\ngeometry_msgs/PoseStamped current_pose\nfloat32 distance_remaining\nfloat32 percent_complete\n"})}),"\n",(0,a.jsx)(n.h3,{id:"code-example-action-server",children:"Code Example: Action Server"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom my_robot_pkg.action import NavigateToGoal\nimport time\n\n\nclass NavigationActionServer(Node):\n    def __init__(self):\n        super().__init__('navigation_action_server')\n\n        self._action_server = ActionServer(\n            self,\n            NavigateToGoal,\n            '/navigate_to_goal',\n            self.execute_callback\n        )\n\n        self.get_logger().info('Navigation Action Server is ready')\n\n    def execute_callback(self, goal_handle):\n        \"\"\"Execute the navigation task\"\"\"\n        self.get_logger().info('Executing goal...')\n\n        # Get the goal\n        target_pose = goal_handle.request.target_pose\n\n        # Simulate navigation with feedback\n        feedback_msg = NavigateToGoal.Feedback()\n        total_distance = 10.0  # meters (simulated)\n\n        for i in range(10):\n            # Check if goal was canceled\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return NavigateToGoal.Result()\n\n            # Simulate progress\n            feedback_msg.distance_remaining = total_distance * (1.0 - i / 10.0)\n            feedback_msg.percent_complete = (i + 1) * 10.0\n\n            # Publish feedback\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Progress: {feedback_msg.percent_complete:.0f}%')\n\n            time.sleep(1.0)  # Simulate work\n\n        # Mark goal as succeeded\n        goal_handle.succeed()\n\n        # Return result\n        result = NavigateToGoal.Result()\n        result.success = True\n        result.total_distance_traveled = total_distance\n\n        self.get_logger().info('Goal succeeded!')\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    server = NavigationActionServer()\n    rclpy.spin(server)\n    server.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"code-example-action-client",children:"Code Example: Action Client"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom my_robot_pkg.action import NavigateToGoal\nfrom geometry_msgs.msg import PoseStamped\n\n\nclass NavigationActionClient(Node):\n    def __init__(self):\n        super().__init__(\'navigation_action_client\')\n\n        self._action_client = ActionClient(\n            self,\n            NavigateToGoal,\n            \'/navigate_to_goal\'\n        )\n\n    def send_goal(self, x, y):\n        """Send a navigation goal"""\n        goal_msg = NavigateToGoal.Goal()\n\n        # Create target pose\n        goal_msg.target_pose = PoseStamped()\n        goal_msg.target_pose.pose.position.x = x\n        goal_msg.target_pose.pose.position.y = y\n\n        self.get_logger().info(\'Waiting for action server...\')\n        self._action_client.wait_for_server()\n\n        self.get_logger().info(f\'Sending goal: ({x}, {y})\')\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        """Called when server accepts or rejects goal"""\n        goal_handle = future.result()\n\n        if not goal_handle.accepted:\n            self.get_logger().info(\'Goal rejected\')\n            return\n\n        self.get_logger().info(\'Goal accepted\')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        """Called when feedback is received"""\n        feedback = feedback_msg.feedback\n        self.get_logger().info(\n            f\'Progress: {feedback.percent_complete:.0f}% | \'\n            f\'Remaining: {feedback.distance_remaining:.1f}m\'\n        )\n\n    def get_result_callback(self, future):\n        """Called when action completes"""\n        result = future.result().result\n        self.get_logger().info(f\'Result: Success={result.success}, Distance={result.total_distance_traveled:.1f}m\')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    client = NavigationActionClient()\n    client.send_goal(10.0, 5.0)\n    rclpy.spin(client)\n    client.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"Actions are perfect for tasks like navigation, manipulation (pick-and-place), battery charging, and map building\u2014anything that takes more than a few seconds and benefits from progress feedback or cancellation."})}),"\n",(0,a.jsx)(n.h2,{id:"parameters-runtime-configuration",children:"Parameters: Runtime Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"why-parameters",children:"Why Parameters?"}),"\n",(0,a.jsxs)(n.p,{children:["Hardcoding values is inflexible. ",(0,a.jsx)("span",{className:"highlight-purple",children:(0,a.jsx)(n.strong,{children:"Parameters"})})," allow runtime configuration:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# Bad: Hardcoded\nself.max_speed = 2.0  # Requires recompiling to change\n\n# Good: Parameter\nself.declare_parameter('max_speed', 2.0)  # Can change via command line or file\n"})}),"\n",(0,a.jsx)(n.h3,{id:"declaring-and-using-parameters",children:"Declaring and Using Parameters"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\n\n\nclass ParameterizedNode(Node):\n    def __init__(self):\n        super().__init__('parameterized_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('max_speed', 2.0)\n        self.declare_parameter('robot_name', 'robot_1')\n        self.declare_parameter('enable_safety', True)\n\n        # Get parameter values\n        self.max_speed = self.get_parameter('max_speed').value\n        self.robot_name = self.get_parameter('robot_name').value\n        self.enable_safety = self.get_parameter('enable_safety').value\n\n        self.get_logger().info(f'Robot: {self.robot_name}')\n        self.get_logger().info(f'Max Speed: {self.max_speed} m/s')\n        self.get_logger().info(f'Safety Enabled: {self.enable_safety}')\n\n        # Set up a timer to demonstrate parameter updates\n        self.create_timer(1.0, self.timer_callback)\n\n    def timer_callback(self):\n        # Re-read parameter (supports dynamic reconfiguration)\n        current_speed = self.get_parameter('max_speed').value\n        if current_speed != self.max_speed:\n            self.get_logger().info(f'Speed changed: {self.max_speed} -> {current_speed}')\n            self.max_speed = current_speed\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ParameterizedNode()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"setting-parameters-from-command-line",children:"Setting Parameters from Command Line"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Set parameters when launching\nros2 run my_robot_pkg parameterized_node --ros-args \\\n  -p max_speed:=3.5 \\\n  -p robot_name:=robot_alpha \\\n  -p enable_safety:=false\n\n# Change parameter at runtime\nros2 param set /parameterized_node max_speed 1.5\n\n# Get current parameter value\nros2 param get /parameterized_node max_speed\n\n# List all parameters\nros2 param list\n"})}),"\n",(0,a.jsx)(n.h3,{id:"loading-parameters-from-yaml",children:"Loading Parameters from YAML"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"config/robot_params.yaml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'parameterized_node:\n  ros__parameters:\n    max_speed: 2.5\n    robot_name: "robot_beta"\n    enable_safety: true\n'})}),"\n",(0,a.jsx)(n.p,{children:"Load when launching:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_pkg parameterized_node --ros-args \\\n  --params-file ~/ros2_ws/src/my_robot_pkg/config/robot_params.yaml\n"})}),"\n",(0,a.jsx)(n.h2,{id:"launch-files-orchestrating-complex-systems",children:"Launch Files: Orchestrating Complex Systems"}),"\n",(0,a.jsx)(n.h3,{id:"why-launch-files",children:"Why Launch Files?"}),"\n",(0,a.jsxs)(n.p,{children:["Starting 10+ nodes manually is tedious and error-prone. ",(0,a.jsx)("span",{className:"highlight-purple",children:(0,a.jsx)(n.strong,{children:"Launch files"})})," automate node startup, parameter loading, and remapping."]}),"\n",(0,a.jsx)(n.h3,{id:"python-launch-file",children:"Python Launch File"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"launch/robot_system.launch.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\nfrom launch.actions import DeclareLaunchArgument, ExecuteProcess\nfrom launch.substitutions import LaunchConfiguration\nimport os\nfrom ament_index_python.packages import get_package_share_directory\n\n\ndef generate_launch_description():\n    # Get package directory\n    pkg_dir = get_package_share_directory('my_robot_pkg')\n\n    # Declare launch arguments\n    use_sim_time = LaunchConfiguration('use_sim_time', default='false')\n\n    # Parameter file path\n    config_file = os.path.join(pkg_dir, 'config', 'robot_params.yaml')\n\n    return LaunchDescription([\n        # Declare arguments\n        DeclareLaunchArgument(\n            'use_sim_time',\n            default_value='false',\n            description='Use simulation time'\n        ),\n\n        # Launch camera driver\n        Node(\n            package='realsense2_camera',\n            executable='realsense2_camera_node',\n            name='camera',\n            namespace='sensors',\n            parameters=[{'use_sim_time': use_sim_time}],\n            output='screen'\n        ),\n\n        # Launch object detector\n        Node(\n            package='my_robot_pkg',\n            executable='object_detector_node',\n            name='detector',\n            parameters=[config_file],\n            remappings=[\n                ('/image', '/sensors/camera/color/image_raw'),\n            ],\n            output='screen'\n        ),\n\n        # Launch robot controller\n        Node(\n            package='my_robot_pkg',\n            executable='robot_controller',\n            name='controller',\n            parameters=[config_file],\n            output='screen'\n        ),\n\n        # Launch RViz for visualization\n        Node(\n            package='rviz2',\n            executable='rviz2',\n            name='rviz2',\n            arguments=['-d', os.path.join(pkg_dir, 'rviz', 'robot.rviz')],\n            output='screen'\n        ),\n    ])\n"})}),"\n",(0,a.jsx)(n.h3,{id:"running-launch-files",children:"Running Launch Files"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Run the launch file\nros2 launch my_robot_pkg robot_system.launch.py\n\n# Pass arguments\nros2 launch my_robot_pkg robot_system.launch.py use_sim_time:=true\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"warning",children:[(0,a.jsxs)(n.p,{children:["Launch files must be installed properly. Add to ",(0,a.jsx)(n.code,{children:"setup.py"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import os\nfrom glob import glob\n\ndata_files=[\n    # ... existing entries ...\n    (os.path.join('share', package_name, 'launch'),\n        glob('launch/*.launch.py')),\n    (os.path.join('share', package_name, 'config'),\n        glob('config/*.yaml')),\n],\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"transforms-tf2-managing-coordinate-frames",children:"Transforms (tf2): Managing Coordinate Frames"}),"\n",(0,a.jsx)(n.h3,{id:"why-tf2",children:"Why tf2?"}),"\n",(0,a.jsx)(n.p,{children:"Robots have multiple coordinate frames:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"base_link"}),": Robot's center"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"camera_link"}),": Camera position"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"lidar_link"}),": LIDAR position"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"map"}),": Fixed world frame"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)("span",{className:"highlight-purple",children:(0,a.jsx)(n.strong,{children:"tf2"})})," manages transforms between these frames, enabling:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'"What is the obstacle\'s position relative to the robot base?"'}),"\n",(0,a.jsx)(n.li,{children:'"Transform camera image coordinates to robot coordinates"'}),"\n",(0,a.jsx)(n.li,{children:'"Where is the robot in the map?"'}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"publishing-a-static-transform",children:"Publishing a Static Transform"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_ros import StaticTransformBroadcaster\n\n\nclass StaticTFPublisher(Node):\n    def __init__(self):\n        super().__init__('static_tf_publisher')\n\n        self.tf_broadcaster = StaticTransformBroadcaster(self)\n\n        # Publish transform from base_link to camera_link\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'camera_link'\n\n        # Camera is 0.2m forward, 0.1m up from base\n        t.transform.translation.x = 0.2\n        t.transform.translation.y = 0.0\n        t.transform.translation.z = 0.1\n\n        # No rotation (quaternion identity)\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = 0.0\n        t.transform.rotation.w = 1.0\n\n        self.tf_broadcaster.sendTransform(t)\n\n        self.get_logger().info('Published static transform base_link -> camera_link')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = StaticTFPublisher()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h3,{id:"querying-transforms",children:"Querying Transforms"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from tf2_ros import Buffer, TransformListener\nfrom rclpy.duration import Duration\n\nclass TransformUser(Node):\n    def __init__(self):\n        super().__init__('transform_user')\n\n        self.tf_buffer = Buffer()\n        self.tf_listener = TransformListener(self.tf_buffer, self)\n\n        self.create_timer(1.0, self.query_transform)\n\n    def query_transform(self):\n        try:\n            # Lookup transform from camera_link to base_link\n            transform = self.tf_buffer.lookup_transform(\n                'base_link',\n                'camera_link',\n                rclpy.time.Time(),\n                timeout=Duration(seconds=1.0)\n            )\n\n            self.get_logger().info(\n                f'Transform: x={transform.transform.translation.x:.2f}, '\n                f'y={transform.transform.translation.y:.2f}, '\n                f'z={transform.transform.translation.z:.2f}'\n            )\n\n        except Exception as e:\n            self.get_logger().warn(f'Could not get transform: {e}')\n"})}),"\n",(0,a.jsx)(n.h3,{id:"visualizing-transforms-in-rviz",children:"Visualizing Transforms in RViz"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Run your node(s) publishing transforms\nros2 run my_robot_pkg static_tf_publisher\n\n# Launch RViz\nrviz2\n\n# In RViz:\n# 1. Add -> TF display\n# 2. Set Fixed Frame to "base_link"\n# 3. See coordinate frames visualized as axes\n'})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices-for-production-systems",children:"Best Practices for Production Systems"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use namespaces"})," to avoid topic name collisions when running multiple robots"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Load parameters from YAML"})," instead of hardcoding"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use launch files"})," even for single nodes (makes future expansion easier)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Publish static transforms"})," for fixed sensors"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use consistent frame IDs"})," (",(0,a.jsx)(n.code,{children:"base_link"}),", ",(0,a.jsx)(n.code,{children:"odom"}),", ",(0,a.jsx)(n.code,{children:"map"})," are conventions)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Log appropriately"}),": INFO for important events, DEBUG for frequent data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Handle exceptions"})," gracefully (e.g., transform timeouts)"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"self-assessment-questions",children:"Self-Assessment Questions"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"When would you use an action instead of a service?"})}),"\n",(0,a.jsx)(s,{children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)("summary",{children:"Answer"}),"\nUse an action when the task takes more than a few seconds and you need: (1) progress feedback to update a UI or monitor progress, (2) the ability to cancel/preempt the task mid-execution, or (3) asynchronous execution so the client can perform other work while waiting. Examples: navigation to a distant goal, picking and placing an object, charging a battery, or building a map. Services are better for quick, synchronous requests like querying current state."]})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"How do parameters differ from topics in terms of data update frequency and use case?"})}),"\n",(0,a.jsx)(s,{children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)("summary",{children:"Answer"}),"\nParameters are for infrequent configuration data that changes rarely (e.g., max speed, PID gains, sensor calibration). They're typically set at startup or adjusted occasionally during runtime. Topics are for continuous streaming data that changes frequently (e.g., sensor readings, velocity commands, robot pose). Parameters use a get/set API, while topics use publish/subscribe messaging."]})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["What is the purpose of the ",(0,a.jsx)(n.code,{children:"tf_buffer"})," in tf2, and why does it need a listener?"]})}),"\n",(0,a.jsx)(s,{children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)("summary",{children:"Answer"}),"\nThe ",(0,a.jsx)(n.code,{children:"tf_buffer"})," stores a time-indexed history of transforms between coordinate frames (typically 10 seconds of data). It needs a ",(0,a.jsx)(n.code,{children:"TransformListener"})," to subscribe to the ",(0,a.jsx)(n.code,{children:"/tf"})," and ",(0,a.jsx)(n.code,{children:"/tf_static"}),' topics where transform data is published. When you query a transform (e.g., "camera to base_link at time T"), the buffer looks up the stored transforms and computes the requested transformation, potentially interpolating between published values for precise timing.']})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Why is it better to use a launch file instead of manually starting nodes in separate terminals?"})}),"\n",(0,a.jsx)(s,{children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)("summary",{children:"Answer"}),"\nLaunch files provide: (1) ",(0,a.jsx)(n.strong,{children:"Automation"}),"\u2014start 10+ nodes with one command, (2) ",(0,a.jsx)(n.strong,{children:"Configuration"}),"\u2014load parameters from YAML files consistently, (3) ",(0,a.jsx)(n.strong,{children:"Remapping"}),"\u2014remap topic names to connect nodes without changing code, (4) ",(0,a.jsx)(n.strong,{children:"Repeatability"}),"\u2014ensure the same startup sequence every time, reducing human error, (5) ",(0,a.jsx)(n.strong,{children:"Documentation"}),"\u2014the launch file serves as documentation of system architecture, and (6) ",(0,a.jsx)(n.strong,{children:"CI/CD"}),"\u2014easily integrate into automated testing and deployment pipelines."]})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"How would you transform a point detected by a camera into the robot's base frame?"})}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)("summary",{children:"Answer"}),"\nUse tf2 to lookup the transform from ",(0,a.jsx)(n.code,{children:"camera_link"})," to ",(0,a.jsx)(n.code,{children:"base_link"}),", then apply it to the point:",(0,a.jsx)("br",{})]}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Get the point coordinates in ",(0,a.jsx)(n.code,{children:"camera_link"})," (e.g., from object detection)",(0,a.jsx)("br",{})]}),"\n",(0,a.jsxs)(n.li,{children:["Create a ",(0,a.jsx)(n.code,{children:"PointStamped"})," message with ",(0,a.jsx)(n.code,{children:"frame_id = 'camera_link'"}),(0,a.jsx)("br",{})]}),"\n",(0,a.jsxs)(n.li,{children:["Use ",(0,a.jsx)(n.code,{children:"tf_buffer.transform()"})," to convert the point to ",(0,a.jsx)(n.code,{children:"base_link"})," frame",(0,a.jsx)("br",{})]}),"\n",(0,a.jsxs)(n.li,{children:["The resulting point is now in robot-centric coordinates, suitable for navigation or manipulation planning",(0,a.jsx)("br",{}),"\nExample: ",(0,a.jsx)(n.code,{children:"transformed_point = tf_buffer.transform(point_in_camera_frame, 'base_link')"})]}),"\n"]})]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"This week, you mastered advanced ROS 2 patterns:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Actions"})," enable long-running tasks with feedback, cancellation, and results"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Parameters"})," provide runtime configuration without recompilation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Launch files"})," orchestrate complex multi-node systems"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"tf2"})," manages coordinate frame transforms for sensor fusion and spatial reasoning"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.p,{children:["In Week 6, we transition from ROS 2 fundamentals to ",(0,a.jsx)(n.strong,{children:"Robot Simulation with Gazebo"}),", where you'll create virtual robot models, define physics properties, and test algorithms safely before deploying to real hardware. You'll learn URDF modeling, sensor plugins, and integration with ROS 2."]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var r=s(6540);const a={},t=r.createContext(a);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);