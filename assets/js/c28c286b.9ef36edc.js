"use strict";(globalThis.webpackChunkai_robotics_book=globalThis.webpackChunkai_robotics_book||[]).push([[9285],{2094:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Module-1-ROS2/week-04-ros2-topics-services","title":"Week 4: ROS 2 Topics and Services","description":"Master asynchronous communication with topics and synchronous request-reply patterns with services in ROS 2.","source":"@site/docs/Module-1-ROS2/week-04-ros2-topics-services.mdx","sourceDirName":"Module-1-ROS2","slug":"/Module-1-ROS2/week-04-ros2-topics-services","permalink":"/ai-robotics-book/docs/Module-1-ROS2/week-04-ros2-topics-services","draft":false,"unlisted":false,"editUrl":"https://github.com/ai-robotics/ai-robotics-book/tree/main/docs/Module-1-ROS2/week-04-ros2-topics-services.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Week 4: ROS 2 Topics and Services","description":"Master asynchronous communication with topics and synchronous request-reply patterns with services in ROS 2."},"sidebar":"tutorialSidebar","previous":{"title":"Week 3: ROS 2 Architecture and Nodes","permalink":"/ai-robotics-book/docs/Module-1-ROS2/week-03-ros2-architecture"},"next":{"title":"Week 5: ROS 2 Advanced Patterns","permalink":"/ai-robotics-book/docs/Module-1-ROS2/week-05-ros2-advanced"}}');var i=s(4848),t=s(8453);const o={sidebar_position:4,title:"Week 4: ROS 2 Topics and Services",description:"Master asynchronous communication with topics and synchronous request-reply patterns with services in ROS 2."},a="Week 4: ROS 2 Topics and Services",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Topics: Asynchronous Publish-Subscribe",id:"topics-asynchronous-publish-subscribe",level:2},{value:"What Are Topics?",id:"what-are-topics",level:3},{value:"When to Use Topics",id:"when-to-use-topics",level:3},{value:"Creating a Subscriber Node",id:"creating-a-subscriber-node",level:3},{value:"Running Publisher and Subscriber Together",id:"running-publisher-and-subscriber-together",level:3},{value:"Custom Message Types",id:"custom-message-types",level:2},{value:"Creating a Custom Message",id:"creating-a-custom-message",level:3},{value:"Using Custom Messages",id:"using-custom-messages",level:3},{value:"Services: Request-Reply Communication",id:"services-request-reply-communication",level:2},{value:"What Are Services?",id:"what-are-services",level:3},{value:"When to Use Services",id:"when-to-use-services",level:3},{value:"Creating a Service Definition",id:"creating-a-service-definition",level:3},{value:"Implementing a Service Server",id:"implementing-a-service-server",level:3},{value:"Implementing a Service Client",id:"implementing-a-service-client",level:3},{value:"Running Service Server and Client",id:"running-service-server-and-client",level:3},{value:"Topics vs Services: Decision Matrix",id:"topics-vs-services-decision-matrix",level:2},{value:"Practical Example: Robot Controller",id:"practical-example-robot-controller",level:2},{value:"Scenario",id:"scenario",level:3},{value:"Self-Assessment Questions",id:"self-assessment-questions",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"week-4-ros-2-topics-and-services",children:"Week 4: ROS 2 Topics and Services"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["In Week 3, you learned that ROS 2 nodes communicate through well-defined interfaces. This week, we dive deep into the two most fundamental communication patterns: ",(0,i.jsx)(n.strong,{children:"topics"})," (for streaming data) and ",(0,i.jsx)(n.strong,{children:"services"})," (for request-reply interactions)."]}),"\n",(0,i.jsx)(n.p,{children:"Topics are the workhorses of ROS 2\u2014they enable asynchronous, many-to-many communication perfect for sensor data, status updates, and continuous data streams. Services, on the other hand, provide synchronous request-reply communication for on-demand tasks like triggering a calculation, querying a state, or requesting a resource."}),"\n",(0,i.jsx)(n.p,{children:"Understanding when to use topics versus services is crucial for designing efficient robotic systems. By the end of this week, you'll build a complete pub-sub system, create custom message types, implement service servers and clients, and know which pattern to apply in different scenarios."}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this week, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement"})," both publisher and subscriber nodes for topic-based communication"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create"})," custom message definitions for domain-specific data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Design"})," service definitions with request and response fields"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Develop"})," service servers that process requests and return responses"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Choose"})," appropriately between topics and services based on use case requirements"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"topics-asynchronous-publish-subscribe",children:"Topics: Asynchronous Publish-Subscribe"}),"\n",(0,i.jsx)(n.h3,{id:"what-are-topics",children:"What Are Topics?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)("span",{className:"highlight-purple",children:(0,i.jsx)(n.strong,{children:"topic"})})," is a named bus over which nodes exchange messages. Topics follow the publish-subscribe pattern:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Publishers"})," send messages to a topic (one-to-many)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Subscribers"})," receive messages from a topic (many-to-one)"]}),"\n",(0,i.jsxs)(n.li,{children:["Publishers and subscribers are ",(0,i.jsx)(n.strong,{children:"decoupled"}),"\u2014they don't know about each other"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:"sequenceDiagram\n    participant P as Publisher Node\n    participant T as Topic<br/>/camera/image\n    participant S1 as Subscriber 1<br/>(Object Detector)\n    participant S2 as Subscriber 2<br/>(Image Logger)\n    participant SRV as Service Server<br/>/calculate_path\n\n    Note over P,S2: Topic Communication (Asynchronous)\n    loop Every 100ms\n        P->>T: Publish(image_data)\n        T->>S1: image_data\n        T->>S2: image_data\n    end\n\n    Note over S1,SRV: Service Communication (Synchronous)\n    S1->>SRV: Request(start, goal)\n    Note over SRV: Processing...\n    SRV->>S1: Response(path)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Diagram:"})," Topics enable asynchronous many-to-many communication (top), while services provide synchronous request-reply patterns (bottom)."]}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-topics",children:"When to Use Topics"}),"\n",(0,i.jsx)(n.p,{children:"Use topics for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sensor data streams"}),": Camera images, LIDAR scans, IMU readings"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Status updates"}),": Battery level, robot pose, system health"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Continuous data"}),": Joint states, velocity commands"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"One-to-many communication"}),": One sensor serving multiple processing nodes"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key characteristics"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Asynchronous (fire-and-forget)"}),"\n",(0,i.jsx)(n.li,{children:"No return value"}),"\n",(0,i.jsx)(n.li,{children:"Can have 0 to N subscribers"}),"\n",(0,i.jsx)(n.li,{children:"Data flows continuously or at regular intervals"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-subscriber-node",children:"Creating a Subscriber Node"}),"\n",(0,i.jsx)(n.p,{children:"Last week, you created a publisher. Now let's build a subscriber to receive those messages:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass MinimalSubscriber(Node):\n    """A simple ROS 2 node that subscribes to messages"""\n\n    def __init__(self):\n        super().__init__(\'minimal_subscriber\')\n\n        # Create a subscription\n        # - Message type: String\n        # - Topic name: \'/chatter\' (must match publisher)\n        # - Callback function: called when message arrives\n        # - Queue size: 10\n        self.subscription = self.create_subscription(\n            String,\n            \'/chatter\',\n            self.listener_callback,\n            10\n        )\n\n        self.get_logger().info(\'Minimal Subscriber Node has been started\')\n\n    def listener_callback(self, msg):\n        """Called whenever a message is received on /chatter"""\n        self.get_logger().info(f\'I heard: "{msg.data}"\')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    minimal_subscriber = MinimalSubscriber()\n\n    try:\n        rclpy.spin(minimal_subscriber)\n    except KeyboardInterrupt:\n        pass\n\n    minimal_subscriber.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"running-publisher-and-subscriber-together",children:"Running Publisher and Subscriber Together"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Terminal 1: Start the publisher\nsource ~/ros2_ws/install/setup.bash\nros2 run my_robot_pkg my_node\n\n# Terminal 2: Start the subscriber\nsource ~/ros2_ws/install/setup.bash\nros2 run my_robot_pkg subscriber_node\n\n# Terminal 2 output:\n# [INFO] [minimal_subscriber]: I heard: "Hello ROS 2! Message #5"\n# [INFO] [minimal_subscriber]: I heard: "Hello ROS 2! Message #6"\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"You can run multiple subscribers on the same topic\u2014they'll all receive copies of every message. This is useful for parallel processing (e.g., one node saves images, another detects objects, another compresses for network transmission)."})}),"\n",(0,i.jsx)(n.h2,{id:"custom-message-types",children:"Custom Message Types"}),"\n",(0,i.jsxs)(n.p,{children:["While ",(0,i.jsx)(n.code,{children:"std_msgs"})," provides basic types (String, Int32, Float64), real robots need domain-specific messages."]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-custom-message",children:"Creating a Custom Message"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create a message directory"})," in your package:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src/my_robot_pkg\nmkdir msg\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Define a message"})," in ",(0,i.jsx)(n.code,{children:"msg/RobotStatus.msg"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'# RobotStatus.msg - Custom message for robot status\n\n# Header with timestamp\nstd_msgs/Header header\n\n# Battery information\nfloat32 battery_voltage       # Voltage in volts\nfloat32 battery_percentage    # Percentage remaining (0.0 - 100.0)\n\n# Localization confidence\nfloat32 localization_confidence  # 0.0 (no idea) to 1.0 (certain)\n\n# Current task\nstring current_task           # e.g., "navigating", "idle", "charging"\n\n# Error flags\nbool obstacle_detected\nbool low_battery_warning\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Update package.xml"})," to include message dependencies:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"\x3c!-- Add these lines to package.xml --\x3e\n<buildtool_depend>rosidl_default_generators</buildtool_depend>\n<exec_depend>rosidl_default_runtime</exec_depend>\n<member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Update setup.py"})," to declare message files:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import os\nfrom glob import glob\nfrom setuptools import setup\n\npackage_name = 'my_robot_pkg'\n\nsetup(\n    name=package_name,\n    version='0.0.1',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        # Include message files\n        (os.path.join('share', package_name, 'msg'),\n            glob('msg/*.msg')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='you@example.com',\n    description='My first ROS 2 package',\n    license='MIT',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'my_node = my_robot_pkg.my_first_node:main',\n            'subscriber_node = my_robot_pkg.subscriber_node:main',\n        ],\n    },\n)\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Build the package"})," to generate message code:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_pkg\nsource install/setup.bash\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The build system automatically generates Python classes from ",(0,i.jsx)(n.code,{children:".msg"})," files."]}),"\n",(0,i.jsx)(n.h3,{id:"using-custom-messages",children:"Using Custom Messages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom my_robot_pkg.msg import RobotStatus  # Import custom message\nfrom std_msgs.msg import Header\n\n\nclass RobotStatusPublisher(Node):\n    def __init__(self):\n        super().__init__('robot_status_publisher')\n\n        self.publisher_ = self.create_publisher(RobotStatus, '/robot/status', 10)\n        self.timer = self.create_timer(1.0, self.publish_status)\n\n        self.battery_voltage = 12.6  # Simulated battery\n\n    def publish_status(self):\n        msg = RobotStatus()\n\n        # Populate header with timestamp\n        msg.header = Header()\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'base_link'\n\n        # Battery information\n        msg.battery_voltage = self.battery_voltage\n        msg.battery_percentage = (self.battery_voltage - 10.0) / 2.6 * 100.0\n\n        # Localization\n        msg.localization_confidence = 0.95\n\n        # Task\n        msg.current_task = 'navigating'\n\n        # Flags\n        msg.obstacle_detected = False\n        msg.low_battery_warning = msg.battery_voltage < 11.0\n\n        self.publisher_.publish(msg)\n        self.get_logger().info(\n            f'Status: {msg.battery_percentage:.1f}% battery, task: {msg.current_task}'\n        )\n\n        # Simulate battery drain\n        self.battery_voltage -= 0.01\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotStatusPublisher()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"Header"})," type includes a timestamp and frame ID (coordinate frame reference). This is standard practice for messages representing physical quantities or sensor data\u2014it allows time synchronization and spatial transforms."]})}),"\n",(0,i.jsx)(n.h2,{id:"services-request-reply-communication",children:"Services: Request-Reply Communication"}),"\n",(0,i.jsx)(n.h3,{id:"what-are-services",children:"What Are Services?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)("span",{className:"highlight-purple",children:(0,i.jsx)(n.strong,{children:"service"})})," provides synchronous request-reply communication:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Client"})," sends a request and waits for a response"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server"})," receives the request, processes it, and returns a response"]}),"\n",(0,i.jsxs)(n.li,{children:["Communication is ",(0,i.jsx)(n.strong,{children:"one-to-one"})," and ",(0,i.jsx)(n.strong,{children:"blocking"})," (client waits)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        Request         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Client  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500>\u2502 Server  \u2502\n\u2502  Node   \u2502                        \u2502  Node   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518<\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               Response\n"})}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,i.jsx)(n.p,{children:"Use services for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"On-demand computation"}),': "Calculate path from A to B"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"State queries"}),': "What is the current robot pose?"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Triggering actions"}),': "Start mapping", "Save map"']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Resource requests"}),': "Allocate processing power", "Lock mutex"']}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key characteristics"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Synchronous (client blocks until response)"}),"\n",(0,i.jsx)(n.li,{children:"One-to-one communication"}),"\n",(0,i.jsx)(n.li,{children:"Suitable for infrequent requests"}),"\n",(0,i.jsx)(n.li,{children:"Not for high-frequency or streaming data"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-definition",children:"Creating a Service Definition"}),"\n",(0,i.jsxs)(n.p,{children:["Similar to messages, services are defined in ",(0,i.jsx)(n.code,{children:".srv"})," files:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create a service directory"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src/my_robot_pkg\nmkdir srv\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Define a service"})," in ",(0,i.jsx)(n.code,{children:"srv/AddTwoInts.srv"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Request: two integers to add\nint64 a\nint64 b\n---\n# Response: sum of the two integers\nint64 sum\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"---"})," separator divides request (above) from response (below)."]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Update package.xml"})," (same as for messages\u2014already done if you created custom messages)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Update setup.py"})," to include service files:"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"(os.path.join('share', package_name, 'srv'),\n    glob('srv/*.srv')),\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Build"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_pkg\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(n.h3,{id:"implementing-a-service-server",children:"Implementing a Service Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom my_robot_pkg.srv import AddTwoInts  # Import custom service\n\n\nclass AddTwoIntsServer(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n\n        # Create a service\n        # - Service type: AddTwoInts\n        # - Service name: '/add_two_ints'\n        # - Callback: handle_add_two_ints\n        self.srv = self.create_service(\n            AddTwoInts,\n            '/add_two_ints',\n            self.handle_add_two_ints\n        )\n\n        self.get_logger().info('Add Two Ints Service is ready')\n\n    def handle_add_two_ints(self, request, response):\n        \"\"\"Service callback: receives request, returns response\"\"\"\n\n        # Access request fields\n        a = request.a\n        b = request.b\n\n        # Perform computation\n        response.sum = a + b\n\n        self.get_logger().info(f'Request: {a} + {b} = {response.sum}')\n\n        # Return the response\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    service_node = AddTwoIntsServer()\n    rclpy.spin(service_node)\n    service_node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"implementing-a-service-client",children:"Implementing a Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport sys\nimport rclpy\nfrom rclpy.node import Node\nfrom my_robot_pkg.srv import AddTwoInts\n\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n\n        # Create a client\n        self.client = self.create_client(AddTwoInts, '/add_two_ints')\n\n        # Wait for service to become available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Waiting for service to become available...')\n\n        self.get_logger().info('Service is available')\n\n    def send_request(self, a, b):\n        \"\"\"Send a request to the service\"\"\"\n\n        # Create a request object\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n\n        # Call the service asynchronously\n        self.future = self.client.call_async(request)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    # Get numbers from command line\n    if len(sys.argv) != 3:\n        print('Usage: ros2 run my_robot_pkg client_node <a> <b>')\n        return\n\n    a = int(sys.argv[1])\n    b = int(sys.argv[2])\n\n    client_node = AddTwoIntsClient()\n    client_node.send_request(a, b)\n\n    # Spin until response is received\n    while rclpy.ok():\n        rclpy.spin_once(client_node)\n        if client_node.future.done():\n            try:\n                response = client_node.future.result()\n                client_node.get_logger().info(f'Result: {a} + {b} = {response.sum}')\n            except Exception as e:\n                client_node.get_logger().error(f'Service call failed: {e}')\n            break\n\n    client_node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"running-service-server-and-client",children:"Running Service Server and Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start the service server\nros2 run my_robot_pkg service_server_node\n\n# Terminal 2: Call the service\nros2 run my_robot_pkg client_node 10 25\n\n# Terminal 2 output:\n# [INFO] [add_two_ints_client]: Result: 10 + 25 = 35\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also call services from the command line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Command-line service call\nros2 service call /add_two_ints my_robot_pkg/srv/AddTwoInts "{a: 10, b: 25}"\n\n# Output: sum: 35\n'})}),"\n",(0,i.jsx)("div",{className:"neon-border",children:(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Best Practice"}),": Always check if a service is available before calling it. Services may not be ready immediately after startup, or the server node might crash. Use ",(0,i.jsx)("code",{children:"wait_for_service()"})," with a timeout to handle this gracefully."]})}),"\n",(0,i.jsx)(n.h2,{id:"topics-vs-services-decision-matrix",children:"Topics vs Services: Decision Matrix"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Criterion"}),(0,i.jsx)(n.th,{children:"Topics"}),(0,i.jsx)(n.th,{children:"Services"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Communication Pattern"})}),(0,i.jsx)(n.td,{children:"Publish-Subscribe (many-to-many)"}),(0,i.jsx)(n.td,{children:"Request-Reply (one-to-one)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Frequency"})}),(0,i.jsx)(n.td,{children:"Continuous/high-frequency"}),(0,i.jsx)(n.td,{children:"Occasional/on-demand"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Blocking"})}),(0,i.jsx)(n.td,{children:"Non-blocking (asynchronous)"}),(0,i.jsx)(n.td,{children:"Blocking (client waits)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Return Value"})}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Example Use Cases"})}),(0,i.jsx)(n.td,{children:"Sensor data, status updates"}),(0,i.jsx)(n.td,{children:"Trigger action, query state"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example: Camera Images"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topic"}),": Stream images at 30 FPS to all subscribers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service"}),': "Capture one high-res image now" (on-demand)']}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example: Path Planning"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topic"}),": Publish current path continuously as it's replanned"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service"}),': "Calculate path from A to B" (request-response)']}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"practical-example-robot-controller",children:"Practical Example: Robot Controller"}),"\n",(0,i.jsx)(n.p,{children:"Let's combine topics and services in a realistic scenario:"}),"\n",(0,i.jsx)(n.h3,{id:"scenario",children:"Scenario"}),"\n",(0,i.jsx)(n.p,{children:"A mobile robot has:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Status topic"})," (",(0,i.jsx)(n.code,{children:"/robot/status"}),"): Publishes battery, pose, task status at 1 Hz"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Velocity command topic"})," (",(0,i.jsx)(n.code,{children:"/cmd_vel"}),"): Receives movement commands at 10 Hz"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Start task service"})," (",(0,i.jsx)(n.code,{children:"/start_task"}),"): Starts a new task when requested"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Stop service"})," (",(0,i.jsx)(n.code,{children:"/emergency_stop"}),"): Immediately halts the robot"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom std_srvs.srv import Trigger\nfrom my_robot_pkg.msg import RobotStatus\n\n\nclass RobotController(Node):\n    def __init__(self):\n        super().__init__(\'robot_controller\')\n\n        # Publishers\n        self.status_pub = self.create_publisher(RobotStatus, \'/robot/status\', 10)\n        self.status_timer = self.create_timer(1.0, self.publish_status)\n\n        # Subscribers\n        self.cmd_vel_sub = self.create_subscription(\n            Twist, \'/cmd_vel\', self.cmd_vel_callback, 10\n        )\n\n        # Services\n        self.emergency_stop_srv = self.create_service(\n            Trigger, \'/emergency_stop\', self.handle_emergency_stop\n        )\n\n        self.is_moving = False\n        self.current_velocity = Twist()\n\n        self.get_logger().info(\'Robot Controller is running\')\n\n    def publish_status(self):\n        """Publish robot status at 1 Hz"""\n        msg = RobotStatus()\n        # ... populate status fields ...\n        self.status_pub.publish(msg)\n\n    def cmd_vel_callback(self, msg):\n        """Receive velocity commands at high frequency"""\n        self.current_velocity = msg\n        self.is_moving = (msg.linear.x != 0.0 or msg.angular.z != 0.0)\n        # Send commands to motor controller...\n\n    def handle_emergency_stop(self, request, response):\n        """Service to immediately stop the robot"""\n        self.get_logger().warn(\'EMERGENCY STOP TRIGGERED\')\n\n        # Stop all motors\n        stop_cmd = Twist()  # All zeros\n        self.current_velocity = stop_cmd\n        self.is_moving = False\n\n        response.success = True\n        response.message = \'Robot stopped successfully\'\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    controller = RobotController()\n    rclpy.spin(controller)\n    controller.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"self-assessment-questions",children:"Self-Assessment Questions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why are topics better than services for streaming sensor data like camera images?"})}),"\n",(0,i.jsx)(s,{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)("summary",{children:"Answer"}),"\nTopics are asynchronous and non-blocking, allowing publishers to send data continuously without waiting for acknowledgment. Multiple subscribers can receive the same camera stream simultaneously (e.g., one for object detection, one for recording). Services are synchronous and block until a response is returned, making them unsuitable for high-frequency data (30+ FPS). If a service client takes 1 second to process an image, the publisher would be blocked for that entire second, creating a bottleneck."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What happens if a subscriber starts after the publisher has already sent messages?"})}),"\n",(0,i.jsx)(s,{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)("summary",{children:"Answer"}),"\nBy default (with Volatile durability QoS), the subscriber will only receive messages published after it connects\u2014past messages are lost. If you want late-joining subscribers to receive the last published message, use Transient Local durability QoS. This is useful for configuration data (e.g., robot calibration parameters) where new nodes need the latest state immediately upon connecting."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When would you choose a service over a topic for robot navigation?"})}),"\n",(0,i.jsx)(s,{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)("summary",{children:"Answer"}),'\nUse a service when you need request-reply semantics, such as: "Calculate a path from current position to goal position"\u2014you send the goal as a request and wait for the computed path as a response. Use a topic when you want continuous updates, such as publishing the current planned path as the robot moves and the path is dynamically replanned. Many navigation systems use both: a service to request initial path computation and a topic to stream updates.']})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How can you verify that a custom message definition was built correctly?"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)("summary",{children:"Answer"}),"\nAfter building with ",(0,i.jsx)(n.code,{children:"colcon build"}),", check:",(0,i.jsx)("br",{})]}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ros2 interface list | grep my_robot_pkg"})," - Should show your message/service types",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ros2 interface show my_robot_pkg/msg/RobotStatus"})," - Displays the message structure",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ros2 topic echo /robot/status"})," (if a node is publishing) - Shows live messages",(0,i.jsx)("br",{}),"\nIf these commands fail, ensure ",(0,i.jsx)(n.code,{children:"package.xml"})," includes ",(0,i.jsx)(n.code,{children:"rosidl_default_generators"})," and ",(0,i.jsx)(n.code,{children:"setup.py"})," includes message files in ",(0,i.jsx)(n.code,{children:"data_files"}),"."]}),"\n"]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["What is the purpose of the ",(0,i.jsx)(n.code,{children:"---"})," separator in a service definition?"]})}),"\n",(0,i.jsx)(s,{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)("summary",{children:"Answer"}),"\nThe ",(0,i.jsx)(n.code,{children:"---"})," separator divides the service definition into two parts: request (above) and response (below). Everything above ",(0,i.jsx)(n.code,{children:"---"})," defines the fields the client sends to the server (the request). Everything below defines the fields the server returns to the client (the response). This structure allows bidirectional data exchange in a single service call, unlike topics which are unidirectional."]})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"This week, you mastered the two fundamental communication patterns in ROS 2:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topics"})," enable asynchronous, many-to-many communication for streaming data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Subscribers"})," receive messages via callback functions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Custom messages"})," allow domain-specific data structures"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Services"})," provide synchronous, request-reply communication"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service servers"})," process requests and return responses"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Choosing the right pattern"})," depends on frequency, blocking behavior, and return values"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.p,{children:["In Week 5, we'll explore ",(0,i.jsx)(n.strong,{children:"ROS 2 Advanced Patterns"}),", including actions (for long-running tasks with feedback), parameters (for runtime configuration), and launch files (for starting multiple nodes simultaneously). You'll also learn about transforms (tf2) for managing coordinate frames\u2014essential for sensor fusion and manipulation."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);